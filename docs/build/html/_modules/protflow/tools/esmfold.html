<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>protflow.tools.esmfold &mdash; ProtFlow 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=8d563738"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            ProtFlow
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../protflow.html">protflow package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ProtFlow</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">protflow.tools.esmfold</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for protflow.tools.esmfold</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">ESMFold Module</span>
<span class="sd">==============</span>

<span class="sd">This module provides the functionality to integrate ESMFold within the ProtFlow framework. It offers tools to run ESMFold, handle its inputs and outputs, and process the resulting data in a structured and automated manner.</span>

<span class="sd">Detailed Description</span>
<span class="sd">--------------------</span>
<span class="sd">The `ESMFold` class encapsulates the functionality necessary to execute ESMFold runs. It manages the configuration of paths to essential scripts and Python executables, sets up the environment, and handles the execution of folding processes. It also includes methods for collecting and processing output data, ensuring that the results are organized and accessible for further analysis within the ProtFlow ecosystem.</span>

<span class="sd">The module is designed to streamline the integration of ESMFold into larger computational workflows. It supports the automatic setup of job parameters, execution of ESMFold commands, and parsing of output files into a structured DataFrame format. This facilitates subsequent data analysis and visualization steps.</span>

<span class="sd">Usage</span>
<span class="sd">-----</span>
<span class="sd">To use this module, create an instance of the `ESMFold` class and invoke its `run` method with appropriate parameters. The module will handle the configuration, execution, and result collection processes. Detailed control over the folding process is provided through various parameters, allowing for customized runs tailored to specific research needs.</span>

<span class="sd">Examples</span>
<span class="sd">--------</span>
<span class="sd">Here is an example of how to initialize and use the `ESMFold` class within a ProtFlow pipeline on a SLURM based queueing system:</span>

<span class="sd">.. code-block:: python</span>

<span class="sd">    from protflow.poses import Poses</span>
<span class="sd">    from protflow.jobstarters import JobStarter</span>
<span class="sd">    from esmfold import ESMFold</span>

<span class="sd">    # Create instances of necessary classes</span>
<span class="sd">    poses = Poses()</span>
<span class="sd">    jobstarter = SbatchArrayJobStarter(max_cores=10, gpus=1) # 1 gpu per node, 10 nodes at once.</span>

<span class="sd">    # Initialize the ESMFold class</span>
<span class="sd">    esmfold = ESMFold()</span>

<span class="sd">    # Run the folding process</span>
<span class="sd">    results = esmfold.run(</span>
<span class="sd">        poses=poses,</span>
<span class="sd">        prefix=&quot;experiment_1&quot;,</span>
<span class="sd">        jobstarter=jobstarter,</span>
<span class="sd">        num_batches=5,</span>
<span class="sd">        options=&quot;--additional_option=value&quot;,</span>
<span class="sd">        overwrite=True</span>
<span class="sd">    )</span>

<span class="sd">    # Access and process the results</span>
<span class="sd">    print(results)</span>

<span class="sd">Further Details</span>
<span class="sd">---------------</span>
<span class="sd">    - Edge Cases: The module handles various edge cases, such as empty pose lists and the need to overwrite previous results. It ensures robust error handling and logging for easier debugging and verification of the folding process.</span>
<span class="sd">    - Customizability: Users can customize the folding process through multiple parameters, including the number of batches, specific options for the ESMFold script, and options for handling pose-specific parameters.</span>
<span class="sd">    - Integration: The module seamlessly integrates with other components of the ProtFlow framework, leveraging shared configurations and data structures to provide a cohesive user experience.</span>

<span class="sd">This module is intended for researchers and developers who need to incorporate ESMFold into their protein design and analysis workflows. By automating many of the setup and execution steps, it allows users to focus on interpreting results and advancing their scientific inquiries.</span>

<span class="sd">Notes</span>
<span class="sd">-----</span>
<span class="sd">This module is part of the ProtFlow package and is designed to work in tandem with other components of the package, especially those related to job management in HPC environments.</span>

<span class="sd">Authors</span>
<span class="sd">-------</span>
<span class="sd">Markus Braun, Adrian Tripp</span>

<span class="sd">Version</span>
<span class="sd">-------</span>
<span class="sd">0.1.0    </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># general imports</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># dependencies</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># custom</span>
<span class="kn">from</span> <span class="nn">protflow.poses</span> <span class="kn">import</span> <span class="n">Poses</span>
<span class="kn">import</span> <span class="nn">protflow.config</span>
<span class="kn">import</span> <span class="nn">protflow.jobstarters</span>
<span class="kn">import</span> <span class="nn">protflow.tools</span>
<span class="kn">from</span> <span class="nn">protflow.runners</span> <span class="kn">import</span> <span class="n">Runner</span><span class="p">,</span> <span class="n">RunnerOutput</span>
<span class="kn">from</span> <span class="nn">protflow.jobstarters</span> <span class="kn">import</span> <span class="n">JobStarter</span>
<span class="kn">from</span> <span class="nn">protflow.config</span> <span class="kn">import</span> <span class="n">AUXILIARY_RUNNER_SCRIPTS_DIR</span> <span class="k">as</span> <span class="n">script_dir</span>

<div class="viewcode-block" id="ESMFold">
<a class="viewcode-back" href="../../../protflow.tools.html#protflow.tools.esmfold.ESMFold">[docs]</a>
<span class="k">class</span> <span class="nc">ESMFold</span><span class="p">(</span><span class="n">Runner</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ESMFold Class</span>
<span class="sd">    =============</span>

<span class="sd">    The `ESMFold` class is a specialized class designed to facilitate the execution of ESMFold within the ProtFlow framework. It extends the `Runner` class and incorporates specific methods to handle the setup, execution, and data collection associated with ESMFold processes.</span>

<span class="sd">    Detailed Description</span>
<span class="sd">    --------------------</span>
<span class="sd">    The `ESMFold` class manages all aspects of running ESMFold simulations. It handles the configuration of necessary scripts and executables, prepares the environment for folding processes, and executes the folding commands. Additionally, it collects and processes the output data, organizing it into a structured format for further analysis.</span>

<span class="sd">    Key functionalities include:</span>
<span class="sd">        - Setting up paths to ESMFold scripts and Python executables.</span>
<span class="sd">        - Configuring job starter options, either automatically or manually.</span>
<span class="sd">        - Handling the execution of ESMFold commands with support for multiple batches.</span>
<span class="sd">        - Collecting and processing output data into a pandas DataFrame.</span>
<span class="sd">        - Preparing input FASTA files for ESMFold predictions and managing output directories.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    An instance of the `ESMFold` class, configured to run ESMFold processes and handle outputs efficiently.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">        - FileNotFoundError: If required files or directories are not found during the execution process.</span>
<span class="sd">        - ValueError: If invalid arguments are provided to the methods.</span>
<span class="sd">        - KeyError: If forbidden options are included in the command options.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Here is an example of how to initialize and use the `ESMFold` class:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        from protflow.poses import Poses</span>
<span class="sd">        from protflow.jobstarters import JobStarter</span>
<span class="sd">        from esmfold import ESMFold</span>

<span class="sd">        # Create instances of necessary classes</span>
<span class="sd">        poses = Poses()</span>
<span class="sd">        jobstarter = JobStarter()</span>

<span class="sd">        # Initialize the ESMFold class</span>
<span class="sd">        esmfold = ESMFold()</span>

<span class="sd">        # Run the folding process</span>
<span class="sd">        results = esmfold.run(</span>
<span class="sd">            poses=poses,</span>
<span class="sd">            prefix=&quot;experiment_1&quot;,</span>
<span class="sd">            jobstarter=jobstarter,</span>
<span class="sd">            num_batches=5,</span>
<span class="sd">            options=&quot;--additional_option=value&quot;,</span>
<span class="sd">            overwrite=True</span>
<span class="sd">        )</span>

<span class="sd">        # Access and process the results</span>
<span class="sd">        print(results)</span>

<span class="sd">    Further Details</span>
<span class="sd">    ---------------</span>
<span class="sd">        - Edge Cases: The class includes handling for various edge cases, such as empty pose lists, the need to overwrite previous results, and the presence of existing score files.</span>
<span class="sd">        - Customization: The class provides extensive customization options through its parameters, allowing users to tailor the folding process to their specific needs.</span>
<span class="sd">        - Integration: Seamlessly integrates with other ProtFlow components, leveraging shared configurations and data structures for a unified workflow.</span>

<span class="sd">    The ESMFold class is intended for researchers and developers who need to perform ESMFold simulations as part of their protein design and analysis workflows. It simplifies the process, allowing users to focus on analyzing results and advancing their research.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ESMFold.__init__">
<a class="viewcode-back" href="../../../protflow.tools.html#protflow.tools.esmfold.ESMFold.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">python_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">protflow</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ESMFOLD_PYTHON_PATH</span><span class="p">,</span> <span class="n">jobstarter</span><span class="p">:</span> <span class="n">JobStarter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the ESMFold class with necessary configurations.</span>

<span class="sd">        This method sets up the ESMFold class, configuring paths to essential scripts and Python executables, and setting up the environment for executing ESMFold processes.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            python_path (str, optional): The path to the Python executable used for running ESMFold. Defaults to the value specified in `protflow.config.ESMFOLD_PYTHON_PATH`.</span>
<span class="sd">            jobstarter (JobStarter, optional): An instance of the JobStarter class, which manages job execution. Defaults to None.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If no path is set for the ESMFold scripts or Python executable.</span>

<span class="sd">        Examples:</span>
<span class="sd">            Here is an example of how to initialize the `ESMFold` class:</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">                from protflow.jobstarters import JobStarter</span>
<span class="sd">                from esmfold import ESMFold</span>

<span class="sd">                # Initialize the ESMFold class with default configurations</span>
<span class="sd">                esmfold = ESMFold()</span>

<span class="sd">                # Initialize the ESMFold class with a custom Python path and jobstarter</span>
<span class="sd">                custom_python_path = &quot;/path/to/custom/python&quot;</span>
<span class="sd">                jobstarter = JobStarter()</span>
<span class="sd">                esmfold = ESMFold(python_path=custom_python_path, jobstarter=jobstarter)</span>

<span class="sd">        Further Details:</span>
<span class="sd">            - **Configuration:** This method sets the script path for ESMFold inference and the Python path. If these are not correctly set in the configuration, a ValueError is raised.</span>
<span class="sd">            - **Initialization:** The method initializes necessary attributes, including the script path, Python path, jobstarter, and other configurations needed for running ESMFold processes.</span>

<span class="sd">        This method prepares the ESMFold class for running folding simulations, ensuring that all necessary configurations and paths are correctly set up.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">script_dir</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No path is set for </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">. Set the path in the config.py file under ESMFOLD_SCRIPT_PATH.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">python_path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No python path is set for </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">. Set the path in the config.py file under ESMFOLD_PYTHON_PATH.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">script_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/esmfold_inference.py&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">python_path</span> <span class="o">=</span> <span class="n">python_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;esmfold.py&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_layers</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jobstarter</span> <span class="o">=</span> <span class="n">jobstarter</span></div>


    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;esmfold.py&quot;</span>

<div class="viewcode-block" id="ESMFold.run">
<a class="viewcode-back" href="../../../protflow.tools.html#protflow.tools.esmfold.ESMFold.run">[docs]</a>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">poses</span><span class="p">:</span> <span class="n">Poses</span><span class="p">,</span> <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">jobstarter</span><span class="p">:</span> <span class="n">JobStarter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">num_batches</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Poses</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute the ESMFold process with given poses and jobstarter configuration.</span>

<span class="sd">        This method sets up and runs the ESMFold process using the provided poses and jobstarter object. It handles the configuration, execution, and collection of output data, ensuring that the results are organized and accessible for further analysis.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            poses (Poses, optional): The Poses object containing the protein structures. Defaults to None.</span>
<span class="sd">            prefix (str): A prefix used to name and organize the output files.</span>
<span class="sd">            jobstarter (JobStarter, optional): An instance of the JobStarter class, which manages job execution. Defaults to None.</span>
<span class="sd">            options (str, optional): Additional options for the ESMFold script. Defaults to None.</span>
<span class="sd">            overwrite (bool, optional): If True, overwrite existing output files. Defaults to False.</span>
<span class="sd">            num_batches (int, optional): The number of batches to split the input poses into for parallel processing. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            RunnerOutput: An instance of the RunnerOutput class, containing the processed poses and results of the ESMFold process.</span>

<span class="sd">        Raises:</span>
<span class="sd">            FileNotFoundError: If required files or directories are not found during the execution process.</span>
<span class="sd">            ValueError: If invalid arguments are provided to the method.</span>
<span class="sd">            KeyError: If forbidden options are included in the command options.</span>

<span class="sd">        Examples:</span>
<span class="sd">            Here is an example of how to use the `run` method:</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">                from protflow.poses import Poses</span>
<span class="sd">                from protflow.jobstarters import JobStarter</span>
<span class="sd">                from esmfold import ESMFold</span>

<span class="sd">                # Create instances of necessary classes</span>
<span class="sd">                poses = Poses()</span>
<span class="sd">                jobstarter = JobStarter()</span>

<span class="sd">                # Initialize the ESMFold class</span>
<span class="sd">                esmfold = ESMFold()</span>

<span class="sd">                # Run the folding process</span>
<span class="sd">                results = esmfold.run(</span>
<span class="sd">                    poses=poses,</span>
<span class="sd">                    prefix=&quot;experiment_1&quot;,</span>
<span class="sd">                    jobstarter=jobstarter,</span>
<span class="sd">                    num_batches=5,</span>
<span class="sd">                    options=&quot;--additional_option=value&quot;,</span>
<span class="sd">                    overwrite=True</span>
<span class="sd">                )</span>

<span class="sd">                # Access and process the results</span>
<span class="sd">                print(results)</span>

<span class="sd">        Further Details:</span>
<span class="sd">            - **Setup and Execution:** The method ensures that the environment is correctly set up, directories are prepared, and necessary commands are constructed and executed.</span>
<span class="sd">            - **Input Preparation:** The method prepares input FASTA files by splitting the input poses into the specified number of batches, optimizing the use of parallel computing resources.</span>
<span class="sd">            - **Output Management:** The method handles the collection and processing of output data, ensuring that results are organized into a pandas DataFrame and accessible for further analysis.</span>
<span class="sd">            - **Customization:** Extensive customization options are provided through parameters, allowing users to tailor the folding process to their specific needs.</span>

<span class="sd">        This method is designed to streamline the execution of ESMFold processes within the ProtFlow framework, making it easier for researchers and developers to perform and analyze folding simulations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># setup runner</span>
        <span class="n">work_dir</span><span class="p">,</span> <span class="n">jobstarter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_run_setup</span><span class="p">(</span>
            <span class="n">poses</span><span class="o">=</span><span class="n">poses</span><span class="p">,</span>
            <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span>
            <span class="n">jobstarters</span><span class="o">=</span><span class="p">[</span><span class="n">jobstarter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobstarter</span><span class="p">,</span> <span class="n">poses</span><span class="o">.</span><span class="n">default_jobstarter</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># Look for output-file in pdb-dir. If output is present and correct, then skip ESMFold.</span>
        <span class="n">scorefile</span> <span class="o">=</span> <span class="s2">&quot;ESMFold_scores.json&quot;</span>
        <span class="n">scorefilepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">scorefile</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">scorefilepath</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">RunnerOutput</span><span class="p">(</span><span class="n">poses</span><span class="o">=</span><span class="n">poses</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">scorefilepath</span><span class="p">),</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="n">index_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">index_layers</span><span class="p">)</span><span class="o">.</span><span class="n">return_poses</span><span class="p">()</span>

        <span class="c1"># set up esm-specific directories</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">((</span><span class="n">fasta_dir</span> <span class="o">:=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">work_dir</span><span class="si">}</span><span class="s2">/input_fastas&quot;</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">((</span><span class="n">esm_preds_dir</span> <span class="o">:=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">work_dir</span><span class="si">}</span><span class="s2">/esm_preds&quot;</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># prep fastas -&gt; split them into number of batches to run</span>
        <span class="n">num_batches</span> <span class="o">=</span> <span class="n">num_batches</span> <span class="ow">or</span> <span class="n">jobstarter</span><span class="o">.</span><span class="n">max_cores</span>
        <span class="n">pose_fastas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prep_fastas_for_prediction</span><span class="p">(</span><span class="n">poses</span><span class="o">=</span><span class="n">poses</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;poses&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">fasta_dir</span><span class="o">=</span><span class="n">fasta_dir</span><span class="p">,</span> <span class="n">max_filenum</span><span class="o">=</span><span class="n">num_batches</span><span class="p">)</span>

        <span class="c1"># check if interfering options were set</span>
        <span class="n">forbidden_options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;--fasta&#39;</span><span class="p">,</span> <span class="s1">&#39;--output_dir&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">options</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">opt</span> <span class="ow">in</span> <span class="n">options</span> <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">forbidden_options</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Options must not contain &#39;--fasta&#39; or &#39;--output_dir&#39;!&quot;</span><span class="p">)</span>

        <span class="c1"># write ESMFold cmds:</span>
        <span class="n">cmds</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">write_cmd</span><span class="p">(</span><span class="n">pose</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="n">esm_preds_dir</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span> <span class="k">for</span> <span class="n">pose</span> <span class="ow">in</span> <span class="n">pose_fastas</span><span class="p">]</span>

        <span class="c1"># run</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting prediction of len </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">poses</span><span class="p">)</span><span class="si">}</span><span class="s2"> sequences on </span><span class="si">{</span><span class="n">jobstarter</span><span class="o">.</span><span class="n">max_cores</span><span class="si">}</span><span class="s2"> cores.&quot;</span><span class="p">)</span>
        <span class="n">jobstarter</span><span class="o">.</span><span class="n">start</span><span class="p">(</span>
            <span class="n">cmds</span><span class="o">=</span><span class="n">cmds</span><span class="p">,</span>
            <span class="n">jobname</span><span class="o">=</span><span class="s2">&quot;ESMFold&quot;</span><span class="p">,</span>
            <span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">output_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">work_dir</span><span class="si">}</span><span class="s2">/&quot;</span>
        <span class="p">)</span>

        <span class="c1"># collect scores</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Predictions finished. Collecting Scores.&quot;</span><span class="p">)</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect_scores</span><span class="p">(</span><span class="n">work_dir</span><span class="o">=</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">scorefile</span><span class="o">=</span><span class="n">scorefilepath</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">RunnerOutput</span><span class="p">(</span><span class="n">poses</span><span class="o">=</span><span class="n">poses</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="n">scores</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="n">index_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">index_layers</span><span class="p">)</span><span class="o">.</span><span class="n">return_poses</span><span class="p">()</span></div>


<div class="viewcode-block" id="ESMFold.prep_fastas_for_prediction">
<a class="viewcode-back" href="../../../protflow.tools.html#protflow.tools.esmfold.ESMFold.prep_fastas_for_prediction">[docs]</a>
    <span class="k">def</span> <span class="nf">prep_fastas_for_prediction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">poses</span><span class="p">:</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">fasta_dir</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">max_filenum</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare input FASTA files for ESMFold predictions.</span>

<span class="sd">        This method splits the input poses into the specified number of batches, prepares the FASTA files, and writes them to the specified directory for ESMFold predictions.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            poses (list[str]): List of paths to FASTA files.</span>
<span class="sd">            fasta_dir (str): Directory to which the new FASTA files should be written.</span>
<span class="sd">            max_filenum (int): Maximum number of FASTA files to be written.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[str]: List of paths to the prepared FASTA files.</span>

<span class="sd">        Examples:</span>
<span class="sd">            Here is an example of how to use the `parse_fastas_for_prediction` method:</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">                from esmfold import ESMFold</span>

<span class="sd">                # Initialize the ESMFold class</span>
<span class="sd">                esmfold = ESMFold()</span>

<span class="sd">                # Prepare FASTA files for prediction</span>
<span class="sd">                fasta_paths = esmfold.parse_fastas_for_prediction(</span>
<span class="sd">                    poses=[&quot;pose1.fa&quot;, &quot;pose2.fa&quot;, &quot;pose3.fa&quot;],</span>
<span class="sd">                    fasta_dir=&quot;/path/to/fasta_dir&quot;,</span>
<span class="sd">                    max_filenum=2</span>
<span class="sd">                )</span>

<span class="sd">                # Access the prepared FASTA files</span>
<span class="sd">                print(fasta_paths)</span>

<span class="sd">        Further Details:</span>
<span class="sd">            - **Input Preparation:** The method merges and splits the input FASTA files into the specified number of batches. It ensures that the FASTA files are correctly formatted and written to the specified directory.</span>
<span class="sd">            - **Customization:** Users can specify the maximum number of FASTA files to be created, allowing for flexibility in managing input data for parallel processing.</span>
<span class="sd">            - **Output Management:** The method returns a list of paths to the newly created FASTA files, which are ready for ESMFold predictions.</span>

<span class="sd">        This method is designed to facilitate the preparation of input data for ESMFold, ensuring that the input FASTA files are organized and ready for processing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">mergefastas</span><span class="p">(</span><span class="n">files</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">replace</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Merges Fastas located in &lt;files&gt; into one single fasta-file called &lt;path&gt;</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">fastas</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">fp</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">fastas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">replace</span><span class="p">:</span>
                <span class="n">fastas</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">replace</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">replace</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fastas</span><span class="p">]</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fastas</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">path</span>

        <span class="c1"># determine how to split the poses into &lt;max_gpus&gt; fasta files:</span>
        <span class="n">splitnum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">poses</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">poses</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_filenum</span> <span class="k">else</span> <span class="n">max_filenum</span>
        <span class="n">poses_split</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array_split</span><span class="p">(</span><span class="n">poses</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">splitnum</span><span class="p">))]</span>

        <span class="c1"># Write fasta files according to the fasta_split determined above and then return:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">mergefastas</span><span class="p">(</span><span class="n">files</span><span class="o">=</span><span class="n">poses</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fasta_dir</span><span class="si">}</span><span class="s2">/fasta_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2">.fa&quot;</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span><span class="s2">&quot;:&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">poses</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">poses_split</span><span class="p">)]</span></div>


<div class="viewcode-block" id="ESMFold.write_cmd">
<a class="viewcode-back" href="../../../protflow.tools.html#protflow.tools.esmfold.ESMFold.write_cmd">[docs]</a>
    <span class="k">def</span> <span class="nf">write_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pose_path</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the command to run ESMFold with the given parameters.</span>

<span class="sd">        This method constructs the command line instruction needed to execute the ESMFold script with the specified pose path, output directory, and additional options.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            pose_path (str): The path to the input FASTA file.</span>
<span class="sd">            output_dir (str): The directory where the ESMFold outputs will be stored.</span>
<span class="sd">            options (str, optional): Additional command-line options for the ESMFold script. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The constructed command line instruction for running ESMFold.</span>

<span class="sd">        Examples:</span>
<span class="sd">            Here is an example of how to use the `write_cmd` method:</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">                from esmfold import ESMFold</span>

<span class="sd">                # Initialize the ESMFold class</span>
<span class="sd">                esmfold = ESMFold()</span>

<span class="sd">                # Write the ESMFold command</span>
<span class="sd">                cmd = esmfold.write_cmd(</span>
<span class="sd">                    pose_path=&quot;/path/to/pose.fa&quot;,</span>
<span class="sd">                    output_dir=&quot;/path/to/output_dir&quot;,</span>
<span class="sd">                    options=&quot;--additional_option=value&quot;</span>
<span class="sd">                )</span>

<span class="sd">                # Access the command</span>
<span class="sd">                print(cmd)</span>

<span class="sd">        Further Details:</span>
<span class="sd">            - **Command Construction:** The method parses additional options and constructs the full command line instruction needed to run the ESMFold script. It ensures that the mandatory arguments, such as the FASTA file and output directory, are correctly included.</span>
<span class="sd">            - **Customization:** Users can specify additional command-line options to customize the execution of the ESMFold script, allowing for flexibility in configuring the prediction process.</span>

<span class="sd">        This method is designed to facilitate the execution of ESMFold by constructing the necessary command line instructions, ensuring that all required parameters and options are included.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># parse options</span>
        <span class="n">opts</span><span class="p">,</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">protflow</span><span class="o">.</span><span class="n">runners</span><span class="o">.</span><span class="n">parse_generic_options</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">python_path</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">protflow</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">AUXILIARY_RUNNER_SCRIPTS_DIR</span><span class="si">}</span><span class="s2">/esmfold_inference.py --fasta </span><span class="si">{</span><span class="n">pose_path</span><span class="si">}</span><span class="s2"> --output_dir </span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">protflow</span><span class="o">.</span><span class="n">runners</span><span class="o">.</span><span class="n">options_flags_to_string</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span><span class="w"> </span><span class="n">flags</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span></div>


<div class="viewcode-block" id="ESMFold.collect_scores">
<a class="viewcode-back" href="../../../protflow.tools.html#protflow.tools.esmfold.ESMFold.collect_scores">[docs]</a>
    <span class="k">def</span> <span class="nf">collect_scores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">work_dir</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">scorefile</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collect and process the scores from ESMFold output.</span>

<span class="sd">        This method collects the JSON and PDB output files from ESMFold predictions, processes the data, and organizes it into a pandas DataFrame.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            work_dir (str): The working directory where ESMFold output files are stored.</span>
<span class="sd">            scorefile (str): The path to the JSON file where the collected scores will be saved.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: A DataFrame containing the collected scores and corresponding file locations.</span>

<span class="sd">        Examples:</span>
<span class="sd">            Here is an example of how to use the `collect_scores` method:</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">                from esmfold import ESMFold</span>

<span class="sd">                # Initialize the ESMFold class</span>
<span class="sd">                esmfold = ESMFold()</span>

<span class="sd">                # Collect scores from ESMFold output</span>
<span class="sd">                scores_df = esmfold.collect_scores(</span>
<span class="sd">                    work_dir=&quot;/path/to/work_dir&quot;,</span>
<span class="sd">                    scorefile=&quot;/path/to/scorefile.json&quot;</span>
<span class="sd">                )</span>

<span class="sd">                # Access the collected scores</span>
<span class="sd">                print(scores_df)</span>

<span class="sd">        Further Details:</span>
<span class="sd">            - **Output Collection:** The method scans the working directory for JSON and PDB output files, reads the JSON files into a DataFrame, and merges it with the locations of the PDB files.</span>
<span class="sd">            - **Data Organization:** The method organizes the collected data into a structured DataFrame, making it accessible for further analysis and ensuring that the scores are saved to the specified JSON file.</span>
<span class="sd">            - **Output Management:** The method also ensures that the temporary directories and files used during the prediction process are cleaned up, maintaining a tidy working environment.</span>

<span class="sd">        This method is designed to streamline the collection and processing of ESMFold output data, ensuring that the results are organized and accessible for further analysis.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># collect all .json files</span>
        <span class="n">pdb_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="s2">&quot;esm_preds&quot;</span><span class="p">)</span>
        <span class="n">fl</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pdb_dir</span><span class="si">}</span><span class="s2">/fasta_*/*.json&quot;</span><span class="p">)</span>
        <span class="n">pl</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pdb_dir</span><span class="si">}</span><span class="s2">/fasta_*/*.pdb&quot;</span><span class="p">)</span>

        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="s1">&#39;output_pdbs&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">pl</span> <span class="o">=</span> <span class="p">[</span><span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">pdb</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span> <span class="k">for</span> <span class="n">pdb</span> <span class="ow">in</span> <span class="n">pl</span><span class="p">]</span>
        <span class="c1"># create dataframe containing new locations</span>
        <span class="n">df_pdb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="n">pl</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">pdb</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">pdb</span> <span class="ow">in</span> <span class="n">pl</span><span class="p">]})</span>

        <span class="c1"># read the files, add origin column, and concatenate into single DataFrame:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fl</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># merge with df containing locations</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_pdb</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;description&#39;</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">scorefile</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">pdb_dir</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Your Name.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>