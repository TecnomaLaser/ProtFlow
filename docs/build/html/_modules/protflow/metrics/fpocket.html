<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>protflow.metrics.fpocket &mdash; ProtFlow 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=8d563738"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            ProtFlow
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../protflow.html">protflow package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ProtFlow</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">protflow.metrics.fpocket</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for protflow.metrics.fpocket</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">FPocket Module</span>
<span class="sd">==============</span>

<span class="sd">This module provides the functionality to integrate FPocket within the ProtFlow framework. It offers tools to run FPocket, handle its inputs and outputs, and process the resulting data in a structured and automated manner. </span>

<span class="sd">Detailed Description</span>
<span class="sd">--------------------</span>
<span class="sd">The `FPocket` class encapsulates the functionality necessary to execute FPocket runs. It manages the configuration of paths to essential scripts and Python executables, sets up the environment, and handles the execution of FPocket processes. It also includes methods for collecting and processing output data, ensuring that the results are organized and accessible for further analysis within the ProtFlow ecosystem.</span>
<span class="sd">The module is designed to streamline the integration of FPocket into larger computational workflows. It supports the automatic setup of job parameters, execution of FPocket commands, and parsing of output files into a structured DataFrame format. This facilitates subsequent data analysis and visualization steps.</span>

<span class="sd">Usage</span>
<span class="sd">-----</span>
<span class="sd">To use this module, create an instance of the `FPocket` class and invoke its `run` method with appropriate parameters. The module will handle the configuration, execution, and result collection processes. Detailed control over the FPocket process is provided through various parameters, allowing for customized runs tailored to specific research needs.</span>

<span class="sd">Examples</span>
<span class="sd">--------</span>
<span class="sd">Here is an example of how to initialize and use the `FPocket` class within a ProtFlow pipeline:</span>

<span class="sd">.. code-block:: python</span>

<span class="sd">    from protflow.poses import Poses</span>
<span class="sd">    from protflow.jobstarters import JobStarter</span>
<span class="sd">    from fpocket import FPocket</span>

<span class="sd">    # Create instances of necessary classes</span>
<span class="sd">    poses = Poses()</span>
<span class="sd">    jobstarter = JobStarter()</span>

<span class="sd">    # Initialize the FPocket class</span>
<span class="sd">    fpocket = FPocket()</span>

<span class="sd">    # Run the FPocket process</span>
<span class="sd">    results = fpocket.run(</span>
<span class="sd">        poses=poses,</span>
<span class="sd">        prefix=&quot;experiment_1&quot;,</span>
<span class="sd">        jobstarter=jobstarter,</span>
<span class="sd">        options=&quot;--some-option value&quot;,</span>
<span class="sd">        pose_options=[&quot;--specific-option value&quot;],</span>
<span class="sd">        overwrite=True</span>
<span class="sd">    )</span>

<span class="sd">    # Access and process the results</span>
<span class="sd">    print(results)</span>

<span class="sd">Further Details</span>
<span class="sd">---------------</span>
<span class="sd">    - Edge Cases: The module handles various edge cases, such as empty pose lists and the need to overwrite previous results. It ensures robust error handling and logging for easier debugging and verification of the FPocket process.</span>
<span class="sd">    - Customizability: Users can customize the FPocket process through multiple parameters, including specific options for the FPocket script and options for handling pose-specific parameters.</span>
<span class="sd">    - Integration: The module seamlessly integrates with other components of the ProtFlow framework, leveraging shared configurations and data structures to provide a cohesive user experience.</span>

<span class="sd">This module is intended for researchers and developers who need to incorporate FPocket into their protein design and analysis workflows. By automating many of the setup and execution steps, it allows users to focus on interpreting results and advancing their scientific inquiries.</span>

<span class="sd">Notes</span>
<span class="sd">-----</span>
<span class="sd">This module is part of the ProtFlow package and is designed to work in tandem with other components of the package, especially those related to job management in HPC environments.</span>

<span class="sd">Author</span>
<span class="sd">------</span>
<span class="sd">Markus Braun, Adrian Tripp</span>

<span class="sd">Version</span>
<span class="sd">-------</span>
<span class="sd">0.1.0    </span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># imports</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="c1"># dependencies</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># custom</span>
<span class="kn">from</span> <span class="nn">protflow.jobstarters</span> <span class="kn">import</span> <span class="n">JobStarter</span>
<span class="kn">from</span> <span class="nn">protflow.poses</span> <span class="kn">import</span> <span class="n">Poses</span>
<span class="kn">from</span> <span class="nn">protflow.runners</span> <span class="kn">import</span> <span class="n">Runner</span><span class="p">,</span> <span class="n">RunnerOutput</span><span class="p">,</span> <span class="n">options_flags_to_string</span><span class="p">,</span> <span class="n">parse_generic_options</span>
<span class="kn">from</span> <span class="nn">protflow.config</span> <span class="kn">import</span> <span class="n">FPOCKET_PATH</span>

<div class="viewcode-block" id="FPocket">
<a class="viewcode-back" href="../../../protflow.metrics.html#protflow.metrics.fpocket.FPocket">[docs]</a>
<span class="k">class</span> <span class="nc">FPocket</span><span class="p">(</span><span class="n">Runner</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FPocket Class</span>
<span class="sd">    =============</span>

<span class="sd">    The `FPocket` class is a specialized class designed to facilitate the execution of FPocket within the ProtFlow framework. It extends the `Runner` class and incorporates specific methods to handle the setup, execution, and data collection associated with FPocket processes.</span>

<span class="sd">    Detailed Description</span>
<span class="sd">    --------------------</span>
<span class="sd">    The `FPocket` class manages all aspects of running FPocket simulations. It handles the configuration of necessary scripts and executables, prepares the environment for pocket detection processes, and executes the FPocket commands. Additionally, it collects and processes the output data, organizing it into a structured format for further analysis.</span>

<span class="sd">    Key functionalities include:</span>
<span class="sd">        - Setting up paths to FPocket scripts and executables.</span>
<span class="sd">        - Configuring job starter options, either automatically or manually.</span>
<span class="sd">        - Handling the execution of FPocket commands with support for multiple options and pose-specific parameters.</span>
<span class="sd">        - Collecting and processing output data into a pandas DataFrame.</span>
<span class="sd">        - Ensuring robust error handling and logging for easier debugging and verification of the FPocket process.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    An instance of the `FPocket` class, configured to run FPocket processes and handle outputs efficiently.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">        - FileNotFoundError: If required files or directories are not found during the execution process.</span>
<span class="sd">        - ValueError: If invalid arguments are provided to the methods.</span>
<span class="sd">        - TypeError: If provided options are not of the expected type.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Here is an example of how to initialize and use the `FPocket` class:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        from protflow.poses import Poses</span>
<span class="sd">        from protflow.jobstarters import JobStarter</span>
<span class="sd">        from fpocket import FPocket</span>

<span class="sd">        # Create instances of necessary classes</span>
<span class="sd">        poses = Poses()</span>
<span class="sd">        jobstarter = JobStarter()</span>

<span class="sd">        # Initialize the FPocket class</span>
<span class="sd">        fpocket = FPocket()</span>

<span class="sd">        # Run the FPocket process</span>
<span class="sd">        results = fpocket.run(</span>
<span class="sd">            poses=poses,</span>
<span class="sd">            prefix=&quot;experiment_1&quot;,</span>
<span class="sd">            jobstarter=jobstarter,</span>
<span class="sd">            options=&quot;--some-option value&quot;,</span>
<span class="sd">            pose_options=[&quot;--specific-option value&quot;],</span>
<span class="sd">            overwrite=True</span>
<span class="sd">        )</span>

<span class="sd">        # Access and process the results</span>
<span class="sd">        print(results)</span>

<span class="sd">    Further Details</span>
<span class="sd">    ---------------</span>
<span class="sd">        - Edge Cases: The class includes handling for various edge cases, such as empty pose lists, the need to overwrite previous results, and the presence of existing score files.</span>
<span class="sd">        - Customization: The class provides extensive customization options through its parameters, allowing users to tailor the FPocket process to their specific needs.</span>
<span class="sd">        - Integration: Seamlessly integrates with other ProtFlow components, leveraging shared configurations and data structures for a unified workflow.</span>

<span class="sd">    The FPocket class is intended for researchers and developers who need to perform FPocket simulations as part of their protein design and analysis workflows. It simplifies the process, allowing users to focus on analyzing results and advancing their research.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># class attributes</span>
    <span class="n">index_layers</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="FPocket.__init__">
<a class="viewcode-back" href="../../../protflow.metrics.html#protflow.metrics.fpocket.FPocket.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fpocket_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">FPOCKET_PATH</span><span class="p">,</span> <span class="n">jobstarter</span><span class="p">:</span> <span class="n">JobStarter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the FPocket class with the specified path and jobstarter configuration.</span>

<span class="sd">        This constructor sets up the FPocket instance by configuring the path to the FPocket executable and initializing the jobstarter object. It ensures that the necessary components are in place for running FPocket processes.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            fpocket_path (str, optional): The path to the FPocket executable. Defaults to the path specified in the ProtFlow configuration (`FPOCKET_PATH`).</span>
<span class="sd">            jobstarter (JobStarter, optional): An instance of the JobStarter class, which manages job execution. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An instance of the FPocket class, ready to run FPocket processes.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the fpocket_path is not provided or is invalid.</span>

<span class="sd">        Examples:</span>
<span class="sd">            Here is an example of how to initialize the FPocket class:</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">                from protflow.jobstarters import JobStarter</span>
<span class="sd">                from fpocket import FPocket</span>

<span class="sd">                # Initialize the FPocket class with default settings</span>
<span class="sd">                fpocket = FPocket()</span>

<span class="sd">                # Initialize the FPocket class with a specific jobstarter</span>
<span class="sd">                jobstarter = JobStarter()</span>
<span class="sd">                fpocket = FPocket(jobstarter=jobstarter)</span>

<span class="sd">        Further Details:</span>
<span class="sd">            - **Path Configuration:** Ensures the FPocket executable path is set correctly, raising an error if the path is not provided or invalid.</span>
<span class="sd">            - **Job Management:** Initializes the jobstarter object to manage the execution of FPocket commands, allowing for integration with job scheduling systems.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fpocket_path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No path was set for </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">. Set the path in the config.py file under FPOCKET_PATH!&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jobstarter</span> <span class="o">=</span> <span class="n">jobstarter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">script_path</span> <span class="o">=</span> <span class="n">fpocket_path</span></div>


    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;fpocket&quot;</span>

<div class="viewcode-block" id="FPocket.run">
<a class="viewcode-back" href="../../../protflow.metrics.html#protflow.metrics.fpocket.FPocket.run">[docs]</a>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">poses</span><span class="p">:</span> <span class="n">Poses</span><span class="p">,</span> <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">jobstarter</span><span class="p">:</span> <span class="n">JobStarter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">str</span><span class="o">|</span><span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">pose_options</span><span class="p">:</span> <span class="nb">str</span><span class="o">|</span><span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">return_full_scores</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Poses</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute the FPocket process with given poses and jobstarter configuration.</span>

<span class="sd">        This method sets up and runs the FPocket process using the provided poses and jobstarter object. It handles the configuration, execution, and collection of output data, ensuring that the results are organized and accessible for further analysis.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            poses (Poses): The Poses object containing the protein structures.</span>
<span class="sd">            prefix (str): A prefix used to name and organize the output files.</span>
<span class="sd">            jobstarter (JobStarter, optional): An instance of the JobStarter class, which manages job execution. Defaults to None.</span>
<span class="sd">            options (str or list[str], optional): Additional options for the FPocket script. Defaults to None.</span>
<span class="sd">            pose_options (str or list[str], optional): A list of pose-specific options for the FPocket script. Defaults to None.</span>
<span class="sd">            return_full_scores (bool, optional): If True, include detailed scores for each pocket in the output. Defaults to False.</span>
<span class="sd">            overwrite (bool, optional): If True, overwrite existing output files. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Poses: An updated Poses object containing the processed poses and results of the FPocket process.</span>

<span class="sd">        Raises:</span>
<span class="sd">            FileNotFoundError: If required files or directories are not found during the execution process.</span>
<span class="sd">            ValueError: If invalid arguments are provided to the method.</span>
<span class="sd">            TypeError: If options or pose_options are not of the expected type.</span>

<span class="sd">        Examples:</span>
<span class="sd">            Here is an example of how to use the `run` method:</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">                from protflow.poses import Poses</span>
<span class="sd">                from protflow.jobstarters import JobStarter</span>
<span class="sd">                from fpocket import FPocket</span>

<span class="sd">                # Create instances of necessary classes</span>
<span class="sd">                poses = Poses()</span>
<span class="sd">                jobstarter = JobStarter()</span>

<span class="sd">                # Initialize the FPocket class</span>
<span class="sd">                fpocket = FPocket()</span>

<span class="sd">                # Run the FPocket process</span>
<span class="sd">                results = fpocket.run(</span>
<span class="sd">                    poses=poses,</span>
<span class="sd">                    prefix=&quot;experiment_1&quot;,</span>
<span class="sd">                    jobstarter=jobstarter,</span>
<span class="sd">                    options=&quot;--some-option value&quot;,</span>
<span class="sd">                    pose_options=[&quot;--specific-option value&quot;],</span>
<span class="sd">                    overwrite=True</span>
<span class="sd">                )</span>

<span class="sd">                # Access and process the results</span>
<span class="sd">                print(results)</span>

<span class="sd">        Further Details:</span>
<span class="sd">            - **Setup and Execution:** The method ensures that the environment is correctly set up, directories are prepared, and necessary commands are constructed and executed. It moves the poses to the working directory and compiles the FPocket commands for execution.</span>
<span class="sd">            - **Output Management:** The method handles the collection and processing of output data, ensuring that results are organized into a structured DataFrame. It includes the location of each pocket and integrates the results back into the Poses object.</span>
<span class="sd">            - **Customization:** Extensive customization options are provided through parameters, allowing users to tailor the FPocket process to their specific needs, including the ability to specify additional FPocket options and pose-specific parameters.</span>

<span class="sd">        This method is designed to streamline the execution of FPocket processes within the ProtFlow framework, making it easier for researchers and developers to perform and analyze pocket detection simulations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># setup runner</span>
        <span class="n">work_dir</span><span class="p">,</span> <span class="n">jobstarter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_run_setup</span><span class="p">(</span>
            <span class="n">poses</span><span class="o">=</span><span class="n">poses</span><span class="p">,</span>
            <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span>
            <span class="n">jobstarters</span><span class="o">=</span><span class="p">[</span><span class="n">jobstarter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">jobstarter</span><span class="p">,</span> <span class="n">poses</span><span class="o">.</span><span class="n">default_jobstarter</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># Look for present outputs</span>
        <span class="n">scorefile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_scores.</span><span class="si">{</span><span class="n">poses</span><span class="o">.</span><span class="n">storage_format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">scores</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_for_existing_scorefile</span><span class="p">(</span><span class="n">scorefile</span><span class="o">=</span><span class="n">scorefile</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">RunnerOutput</span><span class="p">(</span><span class="n">poses</span><span class="o">=</span><span class="n">poses</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="n">scores</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="n">index_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">index_layers</span><span class="p">)</span><span class="o">.</span><span class="n">return_poses</span><span class="p">()</span>

        <span class="c1"># prep options:</span>
        <span class="n">options_l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prep_fpocket_options</span><span class="p">(</span><span class="n">poses</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">pose_options</span><span class="p">)</span>

        <span class="c1"># move poses to input_dir (fpocket runs in the directory of the input pdb file)</span>
        <span class="n">work_poses</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pose</span> <span class="ow">in</span> <span class="n">poses</span><span class="o">.</span><span class="n">poses_list</span><span class="p">():</span>
            <span class="n">new_p</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">pose</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">new_p</span><span class="p">):</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">pose</span><span class="p">,</span> <span class="n">new_p</span><span class="p">)</span>
            <span class="n">work_poses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_p</span><span class="p">)</span>

        <span class="c1"># compile cmds</span>
        <span class="n">cmds</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">script_path</span><span class="si">}</span><span class="s2"> --file </span><span class="si">{</span><span class="n">pose</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">options</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">pose</span><span class="p">,</span> <span class="n">options</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">work_poses</span><span class="p">,</span> <span class="n">options_l</span><span class="p">)]</span>

        <span class="c1"># start</span>
        <span class="n">jobstarter</span><span class="o">.</span><span class="n">start</span><span class="p">(</span>
            <span class="n">cmds</span> <span class="o">=</span> <span class="n">cmds</span><span class="p">,</span>
            <span class="n">jobname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;fpocket_</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">output_path</span> <span class="o">=</span> <span class="n">work_dir</span>
        <span class="p">)</span>

        <span class="c1"># collect outputs and write scorefile</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">collect_fpocket_scores</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">return_full_scores</span><span class="o">=</span><span class="n">return_full_scores</span><span class="p">)</span>
        <span class="n">scores</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">_get_fpocket_input_location</span><span class="p">(</span><span class="n">description</span><span class="p">,</span> <span class="n">cmds</span><span class="p">)</span> <span class="k">for</span> <span class="n">description</span> <span class="ow">in</span> <span class="n">scores</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]</span>
        <span class="n">scores</span><span class="p">[</span><span class="s2">&quot;pocket_location&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="s2">&quot;pocket_location&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_runner_scorefile</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">scorefile</span><span class="p">)</span>

        <span class="c1"># itegrate and return</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="n">RunnerOutput</span><span class="p">(</span><span class="n">poses</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">index_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">index_layers</span><span class="p">)</span><span class="o">.</span><span class="n">return_poses</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">outputs</span></div>


<div class="viewcode-block" id="FPocket.prep_fpocket_options">
<a class="viewcode-back" href="../../../protflow.metrics.html#protflow.metrics.fpocket.FPocket.prep_fpocket_options">[docs]</a>
    <span class="k">def</span> <span class="nf">prep_fpocket_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">poses</span><span class="p">:</span> <span class="n">Poses</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pose_options</span><span class="p">:</span> <span class="nb">str</span><span class="o">|</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare options for the FPocket process based on given parameters.</span>

<span class="sd">        This method processes and prepares the options and pose-specific options for the FPocket run. It filters out forbidden options, merges general options with pose-specific options, and formats them for inclusion in the FPocket commands.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            poses (Poses): The Poses object containing the protein structures.</span>
<span class="sd">            options (str or list[str], optional): General options for the FPocket script. Defaults to None.</span>
<span class="sd">            pose_options (str or list[str], optional): A list of pose-specific options for the FPocket script. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[str]: A list of formatted option strings for each pose, ready to be used in the FPocket commands.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If options or pose_options are not of the expected type.</span>

<span class="sd">        Examples:</span>
<span class="sd">            Here is an example of how to use the `prep_fpocket_options` method:</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">                from protflow.poses import Poses</span>
<span class="sd">                from fpocket import FPocket</span>

<span class="sd">                # Create instances of necessary classes</span>
<span class="sd">                poses = Poses()</span>
<span class="sd">                fpocket = FPocket()</span>

<span class="sd">                # Prepare FPocket options</span>
<span class="sd">                options = &quot;--some-option value&quot;</span>
<span class="sd">                pose_options = [&quot;--specific-option value&quot;]</span>
<span class="sd">                prepared_options = fpocket.prep_fpocket_options(poses, options, pose_options)</span>

<span class="sd">                # Output the prepared options</span>
<span class="sd">                print(prepared_options)</span>

<span class="sd">        Further Details:</span>
<span class="sd">            - **Option Processing:** Merges general and pose-specific options, ensuring that forbidden options are removed and the final option strings are correctly formatted.</span>
<span class="sd">            - **Customization:** Allows for extensive customization of the FPocket process through both general and pose-specific options, providing flexibility in configuring FPocket runs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">forbidden_options</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="s2">&quot;pocket_descr_stdout&quot;</span><span class="p">,</span> <span class="s2">&quot;write_mode&quot;</span><span class="p">]</span>
        <span class="n">pose_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prep_pose_options</span><span class="p">(</span><span class="n">poses</span><span class="p">,</span> <span class="n">pose_options</span><span class="p">)</span>

        <span class="c1"># Iterate through pose options, overwrite options and remove options that are not allowed.</span>
        <span class="n">options_l</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pose_opt</span> <span class="ow">in</span> <span class="n">pose_options</span><span class="p">:</span>
            <span class="n">opts</span><span class="p">,</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">parse_generic_options</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">pose_opt</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">forbidden_options</span><span class="p">:</span>
                <span class="n">opts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">options_l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">options_flags_to_string</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span><span class="n">flags</span><span class="p">))</span>

        <span class="c1"># merge options and pose_options, with pose_options priority and return</span>
        <span class="k">return</span> <span class="n">options_l</span></div>
</div>


<div class="viewcode-block" id="get_outfile_name">
<a class="viewcode-back" href="../../../protflow.metrics.html#protflow.metrics.fpocket.get_outfile_name">[docs]</a>
<span class="k">def</span> <span class="nf">get_outfile_name</span><span class="p">(</span><span class="n">outdir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the name of the output file from the output directory.</span>

<span class="sd">    This function generates the name of the FPocket output file based on the specified output directory.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        outdir (str): The path to the FPocket output directory.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The name of the output file within the specified directory.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Here is an example of how to use the `get_outfile_name` function:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from fpocket import get_outfile_name</span>

<span class="sd">            # Specify the output directory</span>
<span class="sd">            outdir = &quot;path/to/output_directory&quot;</span>

<span class="sd">            # Get the output file name</span>
<span class="sd">            output_file_name = get_outfile_name(outdir)</span>

<span class="sd">            # Display the output file name</span>
<span class="sd">            print(output_file_name)</span>

<span class="sd">    Further Details:</span>
<span class="sd">        - **File Naming:** The function constructs the output file name by modifying the output directory name and appending the appropriate suffix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">outdir</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_out&quot;</span><span class="p">,</span> <span class="s2">&quot;_info.txt&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outdir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2">&quot;</span></div>


<div class="viewcode-block" id="collect_fpocket_scores">
<a class="viewcode-back" href="../../../protflow.metrics.html#protflow.metrics.fpocket.collect_fpocket_scores">[docs]</a>
<span class="k">def</span> <span class="nf">collect_fpocket_scores</span><span class="p">(</span><span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">return_full_scores</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Collect scores from an FPocket output directory.</span>

<span class="sd">    This function collects and processes the scores from FPocket output files located in the specified directory. It aggregates the scores into a pandas DataFrame for further analysis.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        output_dir (str): The path to the directory containing FPocket output files.</span>
<span class="sd">        return_full_scores (bool, optional): If True, include detailed scores for each pocket in the output. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: A DataFrame containing the collected scores from the FPocket output files.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Here is an example of how to use the `collect_fpocket_scores` function:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from fpocket import collect_fpocket_scores</span>

<span class="sd">            # Specify the output directory</span>
<span class="sd">            output_dir = &quot;path/to/output_directory&quot;</span>

<span class="sd">            # Collect scores</span>
<span class="sd">            scores = collect_fpocket_scores(output_dir, return_full_scores=True)</span>

<span class="sd">            # Display the scores</span>
<span class="sd">            print(scores)</span>

<span class="sd">    Further Details:</span>
<span class="sd">        - **Score Aggregation:** The function looks for FPocket output directories, extracts scores from each output file, and combines them into a single DataFrame.</span>
<span class="sd">        - **Detailed Scores:** If the return_full_scores parameter is set to True, the function includes detailed scores for each pocket in the DataFrame.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># collect output_dirs</span>
    <span class="n">output_dirs</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/*_out&quot;</span><span class="p">)</span>

    <span class="c1"># extract individual scores and merge into DF:</span>
    <span class="n">out_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">collect_fpocket_output</span><span class="p">(</span><span class="n">get_outfile_name</span><span class="p">(</span><span class="n">out_dir</span><span class="p">),</span> <span class="n">return_full_scores</span><span class="o">=</span><span class="n">return_full_scores</span><span class="p">)</span> <span class="k">for</span> <span class="n">out_dir</span> <span class="ow">in</span> <span class="n">output_dirs</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out_df</span></div>


<div class="viewcode-block" id="collect_fpocket_output">
<a class="viewcode-back" href="../../../protflow.metrics.html#protflow.metrics.fpocket.collect_fpocket_output">[docs]</a>
<span class="k">def</span> <span class="nf">collect_fpocket_output</span><span class="p">(</span><span class="n">output_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">return_full_scores</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Collect output from a single FPocket output file.</span>

<span class="sd">    This function processes the output of a single FPocket output file, extracting scores and other relevant information into a pandas DataFrame.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        output_file (str): The path to the FPocket output file.</span>
<span class="sd">        return_full_scores (bool, optional): If True, include detailed scores for each pocket in the output. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: A DataFrame containing the processed output from the FPocket file.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Here is an example of how to use the `collect_fpocket_output` function:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from fpocket import collect_fpocket_output</span>

<span class="sd">            # Specify the output file</span>
<span class="sd">            output_file = &quot;path/to/output_file&quot;</span>

<span class="sd">            # Collect output</span>
<span class="sd">            output = collect_fpocket_output(output_file, return_full_scores=True)</span>

<span class="sd">            # Display the output</span>
<span class="sd">            print(output)</span>

<span class="sd">    Further Details:</span>
<span class="sd">        - **Output Processing:** The function reads the FPocket output file, extracts relevant scores and information, and formats them into a DataFrame.</span>
<span class="sd">        - **Detailed Scores:** If the return_full_scores parameter is set to True, the function includes detailed scores for each pocket in the DataFrame.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># instantiate output_dict</span>
    <span class="n">file_scores</span> <span class="o">=</span> <span class="n">parse_fpocket_outfile</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">file_scores</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">output_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_info.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)]})</span>

    <span class="c1"># integrate all scores if option is set:</span>
    <span class="n">top_df</span> <span class="o">=</span> <span class="n">file_scores</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">new_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;top_&quot;</span> <span class="o">+</span> <span class="n">col</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">top_df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">top_df</span> <span class="o">=</span> <span class="n">top_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">top_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">new_cols</span><span class="p">)))</span>
    <span class="n">top_df</span> <span class="o">=</span> <span class="n">top_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;pocket&quot;</span><span class="p">})</span>

    <span class="c1"># collect description and integrate into top_df</span>
    <span class="n">top_df</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_info.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">return_full_scores</span><span class="p">:</span>
        <span class="n">top_df</span><span class="p">[</span><span class="s2">&quot;all_pocket_scores&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_scores</span>

    <span class="c1"># rename pocket_location column back.</span>
    <span class="n">top_df</span> <span class="o">=</span> <span class="n">top_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;top_pocket_location&quot;</span><span class="p">:</span> <span class="s2">&quot;pocket_location&quot;</span><span class="p">})</span>

    <span class="k">return</span> <span class="n">top_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="parse_fpocket_outfile">
<a class="viewcode-back" href="../../../protflow.metrics.html#protflow.metrics.fpocket.parse_fpocket_outfile">[docs]</a>
<span class="k">def</span> <span class="nf">parse_fpocket_outfile</span><span class="p">(</span><span class="n">output_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse the FPocket output file to extract scores.</span>

<span class="sd">    This function reads and parses the FPocket output file, extracting scores and other relevant information into a pandas DataFrame.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        output_file (str): The path to the FPocket output file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: A DataFrame containing the parsed scores from the FPocket output file.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Here is an example of how to use the `parse_fpocket_outfile` function:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from fpocket import parse_fpocket_outfile</span>

<span class="sd">            # Specify the output file</span>
<span class="sd">            output_file = &quot;path/to/output_file&quot;</span>

<span class="sd">            # Parse the output file</span>
<span class="sd">            scores = parse_fpocket_outfile(output_file)</span>

<span class="sd">            # Display the scores</span>
<span class="sd">            print(scores)</span>

<span class="sd">    Further Details:</span>
<span class="sd">        - **File Parsing:** The function reads the FPocket output file, extracts relevant scores and information, and formats them into a DataFrame.</span>
<span class="sd">        - **Score Extraction:** The function processes the file line by line, extracting score data and organizing it into a structured format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">parse_pocket_line</span><span class="p">(</span><span class="n">pocket_line</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Parses singular line &#39;&#39;&#39;</span>
        <span class="c1"># split along colon between column: value</span>
        <span class="n">col</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">pocket_line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">col</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span>

    <span class="c1"># read out file and split along &quot;Pocket&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">pocket_split</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;Pocket&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">]</span>

    <span class="c1"># create empty pocket dict to populate</span>
    <span class="n">pocket_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">raw_str</span> <span class="ow">in</span> <span class="n">pocket_split</span><span class="p">:</span>
        <span class="n">line_split</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">raw_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">]</span>
        <span class="n">pocket_nr</span> <span class="o">=</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">pocket_dict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;pocket_</span><span class="si">{</span><span class="n">pocket_nr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">val</span> <span class="k">for</span> <span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="n">parse_pocket_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]}</span>

    <span class="n">out_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">pocket_dict</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="k">if</span> <span class="n">out_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">out_df</span>
    <span class="n">out_df</span><span class="p">[</span><span class="s2">&quot;pocket_location&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;info.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;out.pdb&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Druggability Score&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_get_fpocket_input_location</span><span class="p">(</span><span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">cmds</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Looks ad a pose_description and tries to find the pose in a list of commands that was used as input to generate the description.</span>
<span class="sd">    This is an internal function for location mapping&#39;&#39;&#39;</span>
    <span class="c1"># first get the cmd that contains &#39;description&#39;</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmd</span> <span class="k">for</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="n">cmds</span> <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2">.pdb&quot;</span> <span class="ow">in</span> <span class="n">cmd</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># extract location of input pdb:</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">substr</span> <span class="k">for</span> <span class="n">substr</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2">.pdb&quot;</span> <span class="ow">in</span> <span class="n">substr</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Your Name.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>